////////////////////////////////////////////////////////////////////////////////////
// Imports
////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////////
// Routes
////////////////////////////////////////////////////////////////////////////////////

var express = require('express');
var moment = require('moment');

var logger = require('../log/logger');

var security = require('../lib/security');

var models = require('../models');
var Agency = models.Agency;


////////////////////////////////////////////////////////////////////////////////////
// Routes
////////////////////////////////////////////////////////////////////////////////////

var router = express.Router();

router.get('/', /*security.ensureJWTAuthenticated,*/ (req, res) => {

  Agency.findAll({}).complete((err, agencies) => {

    if (err) {
      res.json(500, { message: err.message });
    }
    else {
      agencies = agencies.map((agency) => { return agency.toJSON  (); });
      res.json(agencies);
    }
  });

});

router.get('/:agencyId', /*security.ensureJWTAuthenticated,*/ (req, res) => {

  var agencyId = req.query.agencyId;

  Agency.find({ where: { id: agencyId } }).complete((err, agency) => {

    if (err) {
      res.json(500, { message: err.message });
    }
    else {
      res.json(agency.toJSON());
    }
  });

});


////////////////////////////////////////////////////////////////////////////////////
// Exports
////////////////////////////////////////////////////////////////////////////////////

module.exports = router;
