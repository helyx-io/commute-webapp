////////////////////////////////////////////////////////////////////////////////////
// Imports
////////////////////////////////////////////////////////////////////////////////////

var BearerStrategy = require('passport-http-bearer');

var config = require('../../conf/config');

var DB = require('../../lib/db');
var db = DB.schema('commute');


////////////////////////////////////////////////////////////////////////////////////
// Strategy
////////////////////////////////////////////////////////////////////////////////////

var bearerStrategy = new BearerStrategy((token, done) => {
	db.knex("users").where({token: token}).then((user) => {
		if (!user || user.length != 1) {
			done(null, false);
		} else {
			done(null, user[0]);
		}
	}).catch((err) => {
		done(err);
	});
});


////////////////////////////////////////////////////////////////////////////////////
// Exports
////////////////////////////////////////////////////////////////////////////////////

module.exports = bearerStrategy;